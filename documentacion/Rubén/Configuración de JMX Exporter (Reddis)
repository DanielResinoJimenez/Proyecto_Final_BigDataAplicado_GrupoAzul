Aquí tienes el archivo **completamente corregido** con el formato Markdown estándar que utiliza GitHub y la mayoría de editores. He eliminado las URLs anidadas dentro de corchetes en los bloques de código y he limpiado la sintaxis para que los bloques de código, tablas y diagramas se rendericen perfectamente.

Copia y pega el siguiente bloque:

---

# Configuración de JMX Exporter

## Exposición de Métricas Kafka para Monitorización

**Proyecto Integral Big Data 2025-2026** **Sistema de Control de Accesos NFC** **Servidor: nodo1 (172.16.200.28)**

---

## Resumen Ejecutivo

Este documento detalla la configuración del JMX Prometheus Exporter en el broker Kafka ubicado en `nodo1`, permitiendo la exposición de métricas operativas en formato Prometheus para su posterior consumo por sistemas de monitorización externos.

### Especificaciones Técnicas

| Parámetro | Valor |
| --- | --- |
| **Versión** | 1.0 |
| **Fecha** | 15 de Febrero de 2026 |
| **Servidor** | nodo1 (172.16.200.28) |
| **Puerto Métricas** | 7071 |
| **JMX Exporter** | 0.20.0 |
| **Kafka Version** | 2.8.1 |

---

## Arquitectura de la Solución

```text
┌──────────────────────────────────────────┐
│        Kafka Broker (JVM)                │
│        - Expone métricas vía JMX          │
│        - Puerto JMX: 9999                │
└────────────────┬─────────────────────────┘
                 │
                 ↓
┌──────────────────────────────────────────┐
│    JMX Prometheus Exporter (JavaAgent)   │
│    - Lee métricas JMX                    │
│    - Transforma a formato Prometheus     │
│    - Expone en HTTP puerto 7071          │
└────────────────┬─────────────────────────┘
                 │
                 ↓
    http://172.16.200.28:7071/metrics

```

---

## Procedimiento de Instalación

### 1. Descarga del JMX Exporter

Debido a que `nodo1` no tiene acceso directo a Internet, el archivo se descarga desde `ambari11`.

**Paso 1: Descarga en ambari11**

```bash
# Conectar a ambari11 desde nodo1
ssh hadoop@172.16.200.11

# Descargar JMX Prometheus Exporter version 0.20.0
cd /tmp
wget https://repo1.maven.org/maven2/io/prometheus/jmx/jmx_prometheus_javaagent/0.20.0/jmx_prometheus_javaagent-0.20.0.jar

```

**Paso 2: Transferencia a nodo1**

```bash
# Desde nodo1, traer el archivo usando SCP
scp hadoop@172.16.200.11:/tmp/jmx_prometheus_javaagent-0.20.0.jar /opt/

# Establecer permisos correctos
chmod 644 /opt/jmx_prometheus_javaagent-0.20.0.jar
chown root:root /opt/jmx_prometheus_javaagent-0.20.0.jar

```

### 2. Configuración del Archivo YAML

Este archivo define cómo se transforman las métricas JMX a formato Prometheus.

```bash
# Como root en nodo1 crear /opt/kafka-jmx-config.yml
cat > /opt/kafka-jmx-config.yml << 'EOF'
lowercaseOutputName: true
lowercaseOutputLabelNames: true
rules:
  - pattern: kafka.server<type=(.+), name=(.+), clientId=(.+), topic=(.+), partition=(.*)><>Value
    name: kafka_server_$1_$2
    type: GAUGE
    labels:
      clientId: "$3"
      topic: "$4"
      partition: "$5"
  - pattern: kafka.log<type=(.+), name=(.+), topic=(.+), partition=(.+)><>Value
    name: kafka_log_$1_$2
    type: GAUGE
    labels:
      topic: "$3"
      partition: "$4"
EOF

```

### 3. Modificación del Script de Kafka

Añadir el agente al arranque de Kafka editando `/opt/kafka-2.8.1/bin/kafka-server-start.sh`.

```bash
# Buscar la sección JMX settings y configurar así:
if [ -z "$KAFKA_JMX_OPTS" ]; then
  KAFKA_JMX_OPTS="-javaagent:/opt/jmx_prometheus_javaagent-0.20.0.jar=7071:/opt/kafka-jmx-config.yml -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.port=9999 -Djava.rmi.server.hostname=172.16.200.28"
fi
export KAFKA_JMX_OPTS

```

---

## Verificación de la Configuración

### Firewall

Es vital abrir el puerto para que Prometheus pueda acceder:

```bash
firewall-cmd --permanent --add-port=7071/tcp
firewall-cmd --reload

```

### Comprobación de métricas

Una vez reiniciado Kafka, verifica la disponibilidad de datos:

```bash
# Ver las primeras líneas de métricas expuestas
curl -s http://localhost:7071/metrics | head -n 20

```

---

## Troubleshooting

| Síntoma | Diagnóstico | Solución |
| --- | --- | --- |
| **Connection refused** | El proceso Java no cargó el agente | Revisar `ps aux | grep kafka` y ver si incluye el `-javaagent` |
| **No route to host** | Firewall bloqueando el puerto | Ejecutar `firewall-cmd --list-ports` |
| **YAML Errors** | Tabulaciones en el archivo .yml | Asegurarse de usar solo espacios en `/opt/kafka-jmx-config.yml` |

---

**Documento generado:** 15 de Febrero de 2026

**Versión:** 1.0

**Autor:** Proyecto Big Data 2025-2026

---

¿Deseas que te genere un **script de validación automático** en Bash que verifique todos estos puntos (puertos, procesos y conectividad) y te de un reporte de errores?
